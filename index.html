<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrustFlow | Transparent Blockchain Charity</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Courier+Prime:wght@400;700&family=Libre+Barcode+39+Text&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <link rel="stylesheet" href="style.css">
</head>
<body>

    <nav class="navbar">
        <div class="logo">
            <i class="fa-solid fa-hand-holding-heart"></i> TrustFlow
        </div>
        
        <div style="display: flex; gap: 10px; align-items: center;">
            <button id="themeToggle" class="btn btn-outline" style="padding: 10px 15px; border: none;">
                <i class="fa-solid fa-moon"></i>
            </button>

            <div id="connectWrapper">
                <button id="connectButton" class="btn btn-outline">
                    <i class="fa-solid fa-wallet"></i> Connect Wallet
                </button>
            </div>
            
            <div id="walletDisplay" class="wallet-badge" style="display:none;">
                <i class="fa-solid fa-circle-check"></i>
                <span id="walletAddress">0x...</span>
            </div>
        </div>
    </nav>

    <div class="main-container">

        <div class="content-column">
            
            <div class="card">
                <span class="zone-header">Active Project</span>
                <h2 id="projectTitle">Loading Project...</h2>
                <p style="color: var(--text-muted); line-height: 1.6;">
                    This project aims to build a sustainable water well in rural regions. 
                    Donations are locked in a smart contract and released only when work is proven.
                </p>

                <div class="hero-stats">
                    <div class="stat-item">
                        <span class="stat-value" id="projectGoal">...</span>
                        <span class="stat-label">Goal</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="amountRaised">...</span>
                        <span class="stat-label">Raised</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value"><span id="currentMilestone">0</span>/<span id="totalMilestones">0</span></span>
                        <span class="stat-label">Milestones</span>
                    </div>
                </div>
            </div>

            <div class="card" style="border-left: 5px solid var(--success);">
                <span class="zone-header">For Donors</span>
                <h2 style="color: var(--success);"><i class="fa-solid fa-seedling"></i> Make a Donation</h2>
                <p style="margin-bottom: 15px; font-size: 14px; color: var(--text-muted);">Your funds are secure and transparent.</p>
                
                <div style="display: flex; gap: 10px;">
                    <input type="number" id="donateAmount" placeholder="0.001" step="0.001">
                    <button id="donateButton" class="btn btn-green" style="height: 52px;">Donate ETH</button>
                </div>
                <p id="donateStatus" class="status-msg"></p>
            </div>

            <div class="card">
                <span class="zone-header">Project Timeline</span>
                <h2><i class="fa-solid fa-images"></i> Verified Proofs</h2>
                <p style="color: var(--text-muted); font-size: 14px; margin-bottom: 20px;">
                    These images are fetched directly from the blockchain (IPFS), proving the work was verified.
                </p>
                
                <div id="proofGallery" style="display: flex; flex-direction: column; gap: 15px;">
                    <p style="font-style: italic; color: var(--text-muted); font-size: 13px;">No verified milestones yet.</p>
                </div>
            </div>

        </div>

        <div class="sidebar-column">

            <div class="card">
                <span class="zone-header">Charity Access</span>
                <h2><i class="fa-solid fa-camera"></i> Upload Proof</h2>
                <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 15px;">
                    Upload a receipt or photo to request the next fund release.
                </p>
                
                <input type="file" id="proofFile">
                <button id="uploadButton" class="btn" style="width: 100%;">
                    <i class="fa-solid fa-cloud-arrow-up"></i> Upload to IPFS
                </button>
                <p id="uploadStatus" class="status-msg" style="color: var(--primary);"></p>
            </div>

            <div class="card">
                <span class="zone-header">Admin Access</span>
                <h2><i class="fa-solid fa-gavel"></i> Verify Work</h2>
                <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 15px;">
                    Review the IPFS proof and approve the milestone.
                </p>
                <button id="verifyButton" class="btn" style="width: 100%; background-color: #4b5563;">
                    Verify & Release
                </button>
                <p id="verifyStatus" class="status-msg"></p>
            </div>

        </div>
    </div>

    <div id="receiptModal" class="modal-overlay" style="display: none;">
        <div class="receipt-paper">
            <h2 class="receipt-header">CHARITY RECEIPT</h2>
            <p class="receipt-sub">GENERATED BY TRUSTFLOW</p>
            
            <div class="dashed-line"></div>
            
            <div class="receipt-row">
                <span>DATE</span>
                <span id="r-date">...</span>
            </div>
            <div class="receipt-row">
                <span>TIME</span>
                <span id="r-time">...</span>
            </div>
            <div class="receipt-row">
                <span>DONOR</span>
                <span id="r-donor">...</span>
            </div>

            <div class="dashed-line"></div>

            <div class="receipt-items">
                <div class="receipt-row item-row">
                    <span>01 &nbsp; CLEAN WATER DONATION</span>
                    <span id="r-amount">... ETH</span>
                </div>
                <div class="receipt-row item-row">
                    <span>&nbsp; &nbsp; GAS FEE (EST)</span>
                    <span>0.0002 ETH</span>
                </div>
            </div>

            <div class="dashed-line"></div>

            <div class="receipt-row total-row">
                <span>TOTAL AMOUNT</span>
                <span id="r-total">... ETH</span>
            </div>

            <div class="dashed-line"></div>

            <div class="receipt-footer">
                <p>CARD #: **** **** **** ETH</p>
                <p>AUTH CODE: <span id="r-hash">...</span></p>
                <p>THANK YOU FOR HELPING!</p>
                <div class="barcode">|| █ || █ ||| █ || █ ||| █</div>
            </div>

            <div class="receipt-actions">
                <button onclick="closeReceipt()" class="btn close-btn">CLOSE</button>
                <button onclick="downloadReceipt()" class="btn btn-green">DOWNLOAD IMAGE</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
    <script src="app_v2.js"></script> 
</body>
</html>